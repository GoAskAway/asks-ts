// DO NOT EDIT.
// Generated by actr-ts-codegen.

import { ContextBridge, RpcEnvelopeBridge } from '@actor-rtc/actr';
import type { PayloadType } from '@actor-rtc/actr';
import { ATTACH_ROUTE_KEY, UNREGISTERDATASTREAM_ROUTE_KEY, USRPROMPT_ROUTE_KEY } from './ask_service.client.js';
import { AskService_AssistantReply, AskService_AttachRequest, AskService_AttachResponse, AskService_UnregisterRequest, AskService_UnregisterResponse, AskService_UsrPromptRequest } from './ask_service.pb.js';

export interface LocalHandler {
  usrPrompt(request: AskService_UsrPromptRequest, ctx: ContextBridge): Promise<AskService_AssistantReply>;
  attach(request: AskService_AttachRequest, ctx: ContextBridge): Promise<AskService_AttachResponse>;
  unregisterDataStream(request: AskService_UnregisterRequest, ctx: ContextBridge): Promise<AskService_UnregisterResponse>;
}

export async function dispatch(
  handler: LocalHandler,
  ctx: ContextBridge,
  envelope: RpcEnvelopeBridge
): Promise<Buffer> {
  if (envelope.routeKey === USRPROMPT_ROUTE_KEY) {
    const request = AskService_UsrPromptRequest.decode(envelope.payload);
    const response = await handler.usrPrompt(request, ctx);
    return AskService_AssistantReply.encode(response);
  }

  if (envelope.routeKey === ATTACH_ROUTE_KEY) {
    const request = AskService_AttachRequest.decode(envelope.payload);
    const response = await handler.attach(request, ctx);
    return AskService_AttachResponse.encode(response);
  }

  if (envelope.routeKey === UNREGISTERDATASTREAM_ROUTE_KEY) {
    const request = AskService_UnregisterRequest.decode(envelope.payload);
    const response = await handler.unregisterDataStream(request, ctx);
    return AskService_UnregisterResponse.encode(response);
  }

  throw new Error(`Unknown route: ${envelope.routeKey}`);
}